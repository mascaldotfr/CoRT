# If you serve the API files and the website itself on different hosts you'll
# need to activate CORS on your server and change the CoRS setup at
# `collect/submit.php`.
:80 {
	# log stuff to see if means things happen
	log {
		output file /var/log/caddy/access.log
	}

	root * /var/www/html
	file_server

	# Enable gzip compression on the fly
	encode {
		gzip 4
	}

	# Make PHP run for the collector
	php_fastcgi unix//run/php/php8.4-fpm.sock

	# default cache control value
	header Cache-Control "max-age=3600, public, stale-while-revalidate=86400"
	# exception for the API
	handle /CoRT/api/var/* {
		header Cache-Control "no-cache, must-revalidate"
		header Access-Control-Allow-Origin *
		file_server {
			# serve precompressed files generated by the API
			precompressed gzip
		}
	}

}
